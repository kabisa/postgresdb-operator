- name: create user
  block:
  - name: Connect to database, create user, and grant privileges
    postgresql_user:
      db: "{{ item.value.database_name }}"
      port: "{{ item.value.port }}"
      name: "{{ user_name }}"
      login_password: "{{ item.value.admin_password }}"
      login_host: "{{ item.value.address }}"
      login_user: "{{ item.value.admin_user_name }}"
      priv: "{{ item.value.priv }}"
      state: "{{ desired_state }}"
      password: "{{ grantee_password }}"
  rescue:
    - debug:
        msg: 'failed create user / grant privileges'